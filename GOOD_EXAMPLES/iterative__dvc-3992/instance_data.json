{
    "instance_id": "iterative__dvc-3992",
    "hints_text": "@dmpetrov actually we do support yaml, thoguh my tests are very simple, and just uses yaml-encoded list\r\neg:\r\n```\r\n-y: 2\r\n-y: 3\r\n```\r\n\r\n\r\nThe original issue (mentioned by @jorgeorpinel ) is about finding metric inside dictionary. Yaml parsing is already present, mechanism for extracting array of values is used in `JSONPlotData` class, so this issue should be simply about adding `_find_data` method to `YAMLPlotData`, and associated tests.\n@pared so, it this a bug? let's label it appropriately and discuss with @efiop if can fix it this sprint before release.\n> original issue (mentioned by @jorgeorpinel ) is about finding metric inside dictionary\r\n\r\nIf you just convert the JSON example from https://dvc.org/doc/command-reference/plots/show#example-hierarchical-data-json to YAML and try to use it, it gives the same error.\r\n\r\n```yaml\r\n---\r\ntrain:\r\n- accuracy: 0.96658\r\n  loss: 0.10757\r\n- accuracy: 0.97641\r\n  loss: 0.07324\r\n- accuracy: 0.87707\r\n  loss: 0.08136\r\n- accuracy: 0.87402\r\n  loss: 0.09026\r\n- accuracy: 0.8795\r\n  loss: 0.0764\r\n- accuracy: 0.88038\r\n  loss: 0.07608\r\n- accuracy: 0.89872\r\n  loss: 0.08455\r\n```\r\n> Save as `train.yaml.default`\r\n\r\n```console\r\nÎ» dvc run -n yamlplot -d train.yaml.default --plots train.yaml \\\r\n          cp train.yaml.default train.yaml\r\n...\r\nÎ» dvc plots show train.yaml\r\nERROR: unexpected error - 'str' object has no attribute 'keys'\r\n```\r\n\nUPDATE: If you remove the first 2 lines form the YAML file\r\n\r\n```yaml\r\n---\r\ntrain:\r\n```\r\n\r\nit does generate the plot correctly. Not sure whether this is how it should work, please lmk so we can document YAML support and write some examples.",
    "patch": "diff --git a/dvc/repo/plots/data.py b/dvc/repo/plots/data.py\n--- a/dvc/repo/plots/data.py\n+++ b/dvc/repo/plots/data.py\n@@ -237,6 +237,10 @@ def construct_mapping(loader, node):\n \n         return yaml.load(self.content, OrderedLoader)\n \n+    def _processors(self):\n+        parent_processors = super()._processors()\n+        return [_find_data] + parent_processors\n+\n \n def _load_from_revision(repo, datafile, revision):\n     from dvc.repo.tree import RepoTree\n",
    "test_patch": "diff --git a/tests/func/plots/test_plots.py b/tests/func/plots/test_plots.py\n--- a/tests/func/plots/test_plots.py\n+++ b/tests/func/plots/test_plots.py\n@@ -10,9 +10,11 @@\n from funcy import first\n \n from dvc.repo.plots.data import (\n+    JSONPlotData,\n     NoMetricInHistoryError,\n     PlotData,\n     PlotMetricTypeError,\n+    YAMLPlotData,\n )\n from dvc.repo.plots.template import (\n     NoDataForTemplateError,\n@@ -581,3 +583,29 @@ def test_raise_on_wrong_field(tmp_dir, scm, dvc, run_copy_metrics):\n \n     with pytest.raises(NoFieldInDataError):\n         dvc.plots.show(\"metric.json\", props={\"y\": \"no_val\"})\n+\n+\n+def test_load_metric_from_dict_json(tmp_dir):\n+    metric = [{\"acccuracy\": 1, \"loss\": 2}, {\"accuracy\": 3, \"loss\": 4}]\n+    dmetric = {\"train\": metric}\n+\n+    plot_data = JSONPlotData(\"-\", \"revision\", json.dumps(dmetric))\n+\n+    expected = metric\n+    for d in expected:\n+        d[\"rev\"] = \"revision\"\n+\n+    assert list(map(dict, plot_data.to_datapoints())) == expected\n+\n+\n+def test_load_metric_from_dict_yaml(tmp_dir):\n+    metric = [{\"acccuracy\": 1, \"loss\": 2}, {\"accuracy\": 3, \"loss\": 4}]\n+    dmetric = {\"train\": metric}\n+\n+    plot_data = YAMLPlotData(\"-\", \"revision\", yaml.dump(dmetric))\n+\n+    expected = metric\n+    for d in expected:\n+        d[\"rev\"] = \"revision\"\n+\n+    assert list(map(dict, plot_data.to_datapoints())) == expected\n",
    "created_at": "2020-06-09T11:02:37Z",
    "problem_statement": "plots: support yaml\nDVC supports JSON and YAML for metrics, but not for plots.\r\n\r\nDetails: https://github.com/iterative/dvc.org/pull/1382#discussion_r434967192\r\n\r\n---\r\nUPDATE by Jorge:\r\n\r\n- [ ] Let's remember to update docs when this is figured out ðŸ™‚ Either in iterative/dvc.org/pull/1382 or in it's own PR on top of those changes.\n",
    "repo": "iterative/dvc",
    "base_commit": "c1e5b10cbd8d751c7036e26fe62f58edece0e507",
    "version": "1.0",
    "PASS_TO_PASS": [
        "tests/func/plots/test_plots.py::test_throw_on_no_metric_at_all",
        "tests/func/plots/test_plots.py::test_no_plots",
        "tests/func/plots/test_plots.py::test_plot_no_data",
        "tests/func/plots/test_plots.py::test_load_metric_from_dict_json"
    ],
    "FAIL_TO_PASS": [
        "tests/func/plots/test_plots.py::test_load_metric_from_dict_yaml"
    ]
}